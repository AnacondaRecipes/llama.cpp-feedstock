From 03eee8612a42926d0cdde90f5c177808f41b7c85 Mon Sep 17 00:00:00 2001
From: Charles Bousseau <cbousseau@anaconda.com>
Date: Mon, 21 Jul 2025 18:00:38 -0400
Subject: [PATCH] no ARMv9.2 in GCC 11.8

ARMv9.2 support was added with GCC 12
---
 ggml/src/CMakeLists.txt          |  5 +++--
 ggml/src/ggml-cpu/CMakeLists.txt | 11 ++++++-----
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/ggml/src/CMakeLists.txt b/ggml/src/CMakeLists.txt
index 0425fd60a..653b01107 100644
--- a/ggml/src/CMakeLists.txt
+++ b/ggml/src/CMakeLists.txt
@@ -326,8 +326,9 @@ if (GGML_CPU_ALL_VARIANTS)
             ggml_add_cpu_backend_variant(armv8.2_3    DOTPROD FP16_VECTOR_ARITHMETIC SVE)
             ggml_add_cpu_backend_variant(armv8.6_1    DOTPROD FP16_VECTOR_ARITHMETIC SVE MATMUL_INT8)
             ggml_add_cpu_backend_variant(armv8.6_2    DOTPROD FP16_VECTOR_ARITHMETIC SVE MATMUL_INT8 SVE2)
-            ggml_add_cpu_backend_variant(armv9.2_1    DOTPROD FP16_VECTOR_ARITHMETIC SVE MATMUL_INT8 SME)
-            ggml_add_cpu_backend_variant(armv9.2_2    DOTPROD FP16_VECTOR_ARITHMETIC SVE MATMUL_INT8 SVE2 SME)
+            # ARMv9.2 support was added with GCC 12
+            # ggml_add_cpu_backend_variant(armv9.2_1    DOTPROD FP16_VECTOR_ARITHMETIC SVE MATMUL_INT8 SME)
+            # ggml_add_cpu_backend_variant(armv9.2_2    DOTPROD FP16_VECTOR_ARITHMETIC SVE MATMUL_INT8 SVE2 SME)
         elseif (CMAKE_SYSTEM_NAME MATCHES "Android")
             # Android-specific backends with SoC-compatible feature sets
             ggml_add_cpu_backend_variant(android_armv8.0_1)
diff --git a/ggml/src/ggml-cpu/CMakeLists.txt b/ggml/src/ggml-cpu/CMakeLists.txt
index 66a5ad8d2..cab27d7a0 100644
--- a/ggml/src/ggml-cpu/CMakeLists.txt
+++ b/ggml/src/ggml-cpu/CMakeLists.txt
@@ -193,11 +193,12 @@ function(ggml_add_cpu_backend_variant_impl tag_name)
                     if (GGML_INTERNAL_NOSVE)
                         set(ARCH_TAGS "${ARCH_TAGS}+nosve")
                     endif()
-                    if (GGML_INTERNAL_SME)
-                        set(ARM_MCPU "armv9.2-a")
-                        set(ARCH_TAGS "${ARCH_TAGS}+sme")
-                        list(APPEND ARCH_DEFINITIONS GGML_USE_SME)
-                    endif()
+                    # ARMv9.2 support was added with GCC 12
+                    #if (GGML_INTERNAL_SME)
+                    #    set(ARM_MCPU "armv9.2-a")
+                    #    set(ARCH_TAGS "${ARCH_TAGS}+sme")
+                    #    list(APPEND ARCH_DEFINITIONS GGML_USE_SME)
+                    #endif()
                     list(APPEND ARCH_FLAGS "-march=${ARM_MCPU}${ARCH_TAGS}")
                     ggml_add_cpu_backend_features(${GGML_CPU_NAME} arm ${ARCH_DEFINITIONS})
                 endif()
-- 
2.39.5 (Apple Git-154)

